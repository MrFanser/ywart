function OpenLogin(e){$(".Mpage_login").is(":hidden")&&$(".Mpage_login").css("top","100%").show().animate({top:0}),$(".Mpage_login .login").siblings("section").hide(),$(".Mpage_login .login").show(),void 0!==e&&($(".Mpage_login .login").find(".pure-input").val(e),$(".Mpage_login .login .account .tip").html("这个帐号已存在，请直接输入密码")),document.title="登录"}function OpenRegister1(){$(".Mpage_login").is(":hidden")&&$(".Mpage_login").css("top","100%").show().animate({top:0}),$(".Mpage_login .register").siblings("section").hide(),$(".Mpage_login .register").show(),$(".Mpage_login .register .pure-input").val(""),document.title="注册"}function OpenRegister2(){$(".Mpage_login .register_sms_phone_code").siblings("section").hide(),$(".Mpage_login .register_sms_phone_code").show()}function OpenForgetpw(){document.title="忘记密码",$(".Mpage_login .forgetpw").siblings("section").hide(),$(".Mpage_login .forgetpw").show(),$(".Mpage_login .codeimg_login").attr("src","/SessionWriteable/GetLoginCaptcha?t="+new Date)}function OpenNewpassword(){$(".Mpage_login .newpassword").siblings("section").hide(),$(".Mpage_login .newpassword").show()}require(["jquery","bus","common"],function(e,o,n){function i(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(o);return null!=n?unescape(n[2]):null}function t(){$(".Mpage_login .codeimg_reg").attr("src","/SessionWriteable/GetLoginCaptcha?t="+new Date)}function a(){$(".l-captcha").show(),$(".Yzm.inp").hide(),$(".sms_phone_code").hide(),$(".captchaShow").hide(),LUOCAPTCHA.reset()}function s(){var e=$(".Sj input").val();if(r(e)){$(".getY99").off("click");var o={};o.module="Common.VerifyCode",o.action="SendVerifyCode",o.mobile=e,o.captchacode=c,o.verifytype=1,o.sceneType=1,$.ajax({data:o}).done(function(e){e.Success?($(".S_del").hide(),_=setInterval(function(){$(".getY99 a").html(d),-2==--d&&(d=59,$(".getY99").on("click",s),$(".getY99 a").html("发送验证码"),a(),clearInterval(_))},1e3)):($(".TXTIPtip").show(),$(".TXTIPtip").html(e.ErrorMsg))})}else $(".S_del").show(),$(".S_del").html("请输入正确手机号")}function r(e){return!!/^[1][3,4,5,7,8][0-9]{9}$/.test(e)}function l(e,o,n,i){if(null!=p.code_status_sms)return!1;var s={};s.module="Common.VerifyCode",s.action="SendVerifyCode",s.mobile=o,s.captchacode=c,s.verifytype=1,s.sceneType=1,$.ajax({data:s}).done(function(o){if(console.log(o),o.Success&&!o.HasError)p.code_time_sms=59,$(".Mpage_login .sms_phone_btn p").hide(),$(".Mpage_login .sms_phone_btn .djs").css({display:"inline-block"}),p.code_status_sms=setInterval(function(){$(".Mpage_login .djs span").text(p.code_time_sms),0==p.code_time_sms&&($(".Mpage_login .djs span").text("59"),clearInterval(p.code_status_sms),p.code_status_sms=null,$(".Mpage_login .sms_phone_code").addClass("showCall"),$(".Mpage_login .sms_phone_btn p").css({display:"inline-block"}),$(".Mpage_login .sms_phone_btn .djs").hide(),a()),p.code_time_sms--},1e3),void 0!==i&&$.isFunction(i)&&i();else{if(o.HasError&&o.ErrorMsg)switch(o.ErrorData){case"captchacode":$(e).parents("section").find(".li_code_login .tip").text(o.ErrorMsg).show();break;case"mobile":$(e).parents("section").find(".account .tip").text(o.ErrorMsg).show();break;default:alert(o.ErrorMsg)}t()}})}function g(e,o,n,i){if(null!=p.code_status_sms)return!1;var a={};a.module="Common.VerifyCode",a.action="SendVerifyCode",a.mobile=o,a.captchacode=c,a.verifytype=2,a.sceneType=1,$.ajax({data:a}).done(function(o){if(console.log(o),o.Success&&!o.HasError)p.code_time_sms=59,$(".Mpage_login .sms_phone_btn p").hide(),$(".Mpage_login .sms_phone_btn .djs").show(),p.code_status_sms=setInterval(function(){$(".Mpage_login .djs span").text(p.code_time_sms),0==p.code_time_sms&&(clearInterval(p.code_status_sms),p.code_status_sms=null,$(".Mpage_login .sms_phone_code").addClass("showCall"),$(".Mpage_login .sms_phone_btn p").show(),$(".Mpage_login .sms_phone_btn .djs").hide()),p.code_time_sms--},1e3),void 0!==i&&$.isFunction(i)&&i();else{if(o.HasError&&o.ErrorMsg)switch(o.ErrorData){case"captchacode":$(e).parents("section").find(".li_code_login .tip").text(o.ErrorMsg).show();break;case"mobile":$(e).parents("section").find(".account .tip").text(o.ErrorMsg).show();break;default:alert(o.ErrorMsg)}t()}})}null!=i("agentcode")&&($("#weibo").attr("href","/Auth/WeiboLogin?agentcode=121686167"),$("#weixin").attr("href","/Auth/WeixinLogin?agentcode=121686167")),$(".Mpage_login input").on("blur",function(){""!=$.trim($(this).val())&&$(this).removeClass("wantInput")}),$(".Mpage_login .back_btn").click(function(){-1!=location.href.indexOf("/Login")||-1!=location.href.indexOf("/login")?common.returnrefererr("/"):$(".Mpage_login").hide()}),window.loginpass=function(){if($(".Mpage_login").hide(),common.LOGIN_CALLBACK)common.LOGIN_CALLBACK()&&(location.href=location.href);else{if(""!=location.search&&void 0!==location.search.split("returnurl=")[1])return void(location.href=decodeURIComponent(location.search.split("returnurl=")[1].split("&")[0]));-1!=location.href.indexOf("/Login")||-1!=location.href.indexOf("/login")?common.returnrefererr("/"):common.pass("/")}};var p={};$(".Mpage_login .codeimg_login,.codeimg_reg").on("click",function(){$(this).attr("src","/SessionWriteable/GetLoginCaptcha?t="+new Date)}),$(".Mpage_login .register .code_sms").click(function(){var e=this;$(".Mpage_login .register input").removeClass("wantInput");var o=$(".Mpage_login .register .pure-input").val();if(""==o)return $(".Mpage_login .register .pure-input").addClass("wantInput"),!1;if(!common.mobileReg.test(o))return $(e).parent().siblings(".account").find(".tip").html("请填写手机号").css({display:"block"}),!1;$(e).parent().siblings(".account").find(".tip").html("").css({display:"none"});var n={};n.module="Auth.Login",n.action="CheckIsMobileReg",n.account=o,$.ajax({data:n}).done(function(n){if($(e).attr("disabled",!1),n.Success&&!n.HasError){"0"==n.Data?l(e,o,0,OpenRegister2):$(e).parent().siblings(".account").find(".tip").html("这个帐号已经注册过了，请直接登录").css({display:"block"})}else n.HasError&&n.ErrorMsg&&alert(n.ErrorMsg)})}),$(".Mpage_login .register_sms_phone_code .code_sms").click(function(){var e=$(".Mpage_login .register .pure-input").val();$(".Mpage_login .register .code_login").val();l(this,e,0)}),$(".Mpage_login .register_sms_phone_code .code_phone").click(function(){g(this,$(".Mpage_login .register .pure-input").val(),$(".Mpage_login .register .code_login").val())}),$(".Mpage_login .submit_reg").on("click",function(){if($(this).attr("disabled",!0),$(".Mpage_login .register_sms_phone_code input").removeClass("wantInput"),0==agree.checked)return alert("请阅读并同意用户协议"),void $(this).attr("disabled",!1);var e=$(".Mpage_login .register_sms_phone_code .sms_phone_code .code_value").val();if(""==e)return $(".Mpage_login .register_sms_phone_code .sms_phone_code input").addClass("wantInput"),void $(".Mpage_login .submit_reg").removeAttr("disabled");var o=$(".Mpage_login .pwd_reg").val();if(""==o)return $(".Mpage_login .pwd_reg").addClass("wantInput"),void $(".Mpage_login .submit_reg").removeAttr("disabled");if(o.length<6)return $(".Mpage_login .pwd_reg").parents(".put_pw").find(".tip").html("请设置6位以上密码").css({display:"block"}),void $(".Mpage_login .submit_reg").removeAttr("disabled");if(o.length>16)return $(".Mpage_login .pwd_reg").parents(".put_pw").find(".tip").html("请设置16位以下密码").css({display:"block"}),void $(".Mpage_login .submit_reg").removeAttr("disabled");$(".Mpage_login .pwd_reg").parents(".put_pw").find(".tip").html("").show(),$(".Mpage_login .tip").html("").show();var n=$(".Mpage_login .register .pure-input").val();if(common.mobileReg.test(n)){var t={};t.module="Auth.Reg",t.action="UserReg",t.account=n,t.verifyCode=e,t.pwd=o,t.regtype=2,null!=i("agentcode")&&(t.agentcode="121686167"),$.ajax({url:"/ajaxbase/index",data:t}).done(function(e){if($(".Mpage_login .submit_reg").removeAttr("disabled"),e.Success&&!e.HasError)loginpass();else if(e.HasError&&e.ErrorMsg)switch(e.ErrorData){case"pwd":$(".Mpage_login .register_sms_phone_code .put_pw .tip").text(e.ErrorMsg).show();break;case"verifyCode":$(".Mpage_login .register_sms_phone_code .sms_phone_code .tip").text(e.ErrorMsg).show();break;default:alert(e.ErrorMsg)}})}else alert("你输入的不是一个有效的手机号"),$(".Mpage_login .submit_reg").removeAttr("disabled"),OpenRegister1()}),$(".Mpage_login .submit_login").on("click",function(){$(".Mpage_login .submit_login").attr("disabled",!0);var e=$(".Mpage_login .login .pure-input").val();if($(".Mpage_login .login input").removeClass("wantInput"),""==e)return $(".Mpage_login .login .account input").addClass("wantInput"),$(".Mpage_login .submit_login").attr("disabled",!1),!1;$(".Mpage_login .login .account .tip").html("").css({display:"none"});var o=common.emailReg.test(e)?1:0,n=common.mobileReg.test(e)?2:0,i=$(".Mpage_login .pwd_login").val();if(""==i)return $(".Mpage_login .loginpw input").addClass("wantInput"),void $(".Mpage_login .submit_login").attr("disabled",!1);$(".Mpage_login .loginpw .tip").html("").show();var t=Math.max(o,n);if(t>0){var a={};a.module="Auth.Login",a.action="UserLogin",a.account=e,a.pwd=i,a.type=t,$.ajax({url:"/ajaxbase/index",data:a}).done(function(e){if($(".Mpage_login .submit_login").attr("disabled",!1),e.Success&&!e.HasError)loginpass();else if(e.HasError&&e.ErrorMsg)switch(e.ErrorData){case"pwd":$(".Mpage_login .loginpw .tip").text(e.ErrorMsg).show();break;case"account":$(".Mpage_login .login .account .tip").text(e.ErrorMsg).show();break;default:alert(e.ErrorMsg)}})}else $(".Mpage_login .login .account .tip").html("请填写有效的帐号").css({display:"block"}),$(".Mpage_login .submit_login").attr("disabled",!1)}),$(".TogLogin div").click(function(){$(this).addClass("active").siblings().removeClass("active"),$(".jli").eq($(this).index()).show().siblings(".jli").hide()});var c="";window.captchaCheck=function(e){$(".l-captcha").hide(),$(".Yzm.inp").show(),$(".sms_phone_code").show(),$(".captchaShow").show(),c=e};var d=59,_=null;$(".getY99").on("click",s),$(".Lo_Btn99").on("click",function(){var e=$(".Sj input").val(),o=$(".Yzm input").val();if(r(e)){console.log(o);var n={};n.module="Auth.Login",n.action="UserLogin",n.account=e,n.verifycode=o,n.type=2,$.ajax({url:"/ajaxbase/index",data:n}).done(function(e){e.Success?loginpass():($(".Y_del").show(),$(".Y_del").html("验证码不正确"))})}else $(".S_del").show(),$(".S_del").html("请输入正确手机号")}),$(".Mpage_login .forgetpw .code_sms,.forgetpw .code_phone").click(function(){var e=this;$(".Mpage_login .forgetpw input").removeClass("wantInput");var o=$(".Mpage_login .forgetpw .pure-input").val();if(""==o||!common.mobileReg.test(o))return $(".Mpage_login .forgetpw .account input").addClass("wantInput"),!1;$(".Mpage_login .forgetpw .account .tip").html("").css({display:"none"});var n={};n.module="Auth.Login",n.action="CheckIsMobileReg",n.account=o,$.ajax({data:n}).done(function(n){if($(e).attr("disabled",!1),console.log(n.Success&&!n.HasError),n.Success&&!n.HasError){"1"==n.Data?$(e).hasClass("code_sms")?l(e,o,0):g(e,o,0):$(e).parents("section").find(".account .tip").html("这个帐号还未注册过！").css({display:"block"})}else n.HasError&&n.ErrorMsg&&alert(n.ErrorMsg)})}),$(".Mpage_login .next1").click(function(){$(".Mpage_login .next1").attr("disabled",!0),$(".Mpage_login .forgetpw .li_code_login .tip").html("").css({display:"none"}),$(".Mpage_login .forgetpw input").removeClass("wantInput");var e=$(".Mpage_login .forgetpw .pure-input").val();if(""==e)return $(".Mpage_login .forgetpw .account input").addClass("wantInput"),$(".Mpage_login .next1").attr("disabled",!1),!1;if(!common.mobileReg.test(e))return $(".Mpage_login .forgetpw .account .tip").html("请填写手机号").css({display:"block"}),$(".Mpage_login .next1").attr("disabled",!1),!1;$(".Mpage_login .forgetpw .account .tip").html("").css({display:"none"});var o=$(".Mpage_login .forgetpw .sms_phone_code .code_value").val();if(""==o)return $(".Mpage_login .forgetpw .sms_phone_code input").addClass("wantInput"),$(".Mpage_login .next1").attr("disabled",!1),!1;$(".Mpage_login .forgetpw .sms_phone_code .tip").html("").css({display:"none"});var n={};n.module="Common.VerifyCode",n.action="CheckSmsVerifyCode",n.phone=e,n.verifycode=o,$.ajax({data:n}).done(function(e){e.Success&&!e.HasError?OpenNewpassword():e.HasError&&e.ErrorMsg&&$(".Mpage_login .forgetpw .sms_phone_code .tip").html(e.ErrorMsg).css({display:"block"}),$(".Mpage_login .next1").attr("disabled",!1)})}),$(".Mpage_login .newpwddone").click(function(){$(".Mpage_login .newpassword .tip").html("").hide(),$(".Mpage_login .newpassword input").removeClass("wantInput");var e=$(".Mpage_login .pwd1").val();if(""==e)return $(".Mpage_login .pwd1").addClass("wantInput"),!1;if(""==$(".Mpage_login .pwd2").val())return $(".Mpage_login .pwd2").addClass("wantInput"),!1;var o=$(".Mpage_login .forgetpw .pure-input").val();if($(".Mpage_login .pwd1").val()!=$(".Mpage_login .pwd2").val())$(".Mpage_login .tip").html("请输入两次相同的密码").show();else if(e.length<6)$(".Mpage_login .tip").html("请设置6位以上密码").show(),$(".Mpage_login .set_password").attr("disabled",!1);else if(e.length>16)$(".Mpage_login .tip").html("请设置16位以下密码").show(),$(".Mpage_login .set_password").attr("disabled",!1);else{var n={};n.module="Auth.ForgetPwd",n.action="SmsResetPwd",n.phone=o,n.verifycode=$(".Mpage_login .forgetpw .sms_phone_code .code_value").val(),n.pwd=e,$.ajax({data:n}).done(function(e){if(console.log(e),e.Success&&!e.HasError)alert("密码重设成功"),OpenLogin(o);else if(e.HasError&&e.ErrorMsg)switch(e.ErrorData){case"pwd":$(".Mpage_login .newpassword .reputpw .tip").html(e.ErrorMsg).show();break;case"phone":$(".Mpage_login .newpassword .account .tip").text(e.ErrorMsg).show();break;case"verifycode":alert(e.ErrorMsg),OpenForgetpw();break;default:alert(e.ErrorMsg)}})}}),$(".newpassword .reputpw div b").on("click",function(){"password"==$(this).prev().attr("type")?$(this).prev().attr("type","text"):$(this).prev().attr("type","password")}),$(".Mpage_login .hadaccount").on("click",function(){OpenLogin()}),$(".Mpage_login .registerbtn").on("click",function(){OpenRegister1()}),$(".Mpage_login .forgetpwbtn>a").on("click",function(){OpenForgetpw()})});